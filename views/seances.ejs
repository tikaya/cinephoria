<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>S√©ances - Cin√©phoria</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/styles.css">
  <style>
    :root{ --gold:#f5c518; --ink:#0a0f1f; --card:rgba(255,255,255,.06); --border:rgba(245,197,24,.35) }
    html,body{height:100%;margin:0}
    body{
      display:flex; flex-direction:column; min-height:100vh;
      background:#0a0f1f; color:#f1f1f1; font-family:'Poppins',sans-serif;
      opacity:0; transition:opacity .5s ease;
    }
    body.loaded{opacity:1}
    main{flex:1; padding-bottom:32px}
    header, footer{ background:rgba(10,15,31,.85); color:#eaeaea; }
    h1{ font-family:'Cinzel',serif; color:var(--gold); text-align:center; margin:22px 0 10px }

    .btn-cinema{ background:var(--gold); color:#000; font-weight:700; border:none; border-radius:10px; padding:9px 12px }
    .btn-cinema:hover{ background:#ffd84d }

    .show-card{
      background:var(--card); border:1px solid var(--border);
      border-radius:12px; padding:14px; height:100%;
      transition:transform .2s ease, box-shadow .25s ease;
    }
    .show-card:hover{ transform:translateY(-2px); box-shadow:0 0 18px rgba(245,197,24,.25) }
    .show-title{ color:var(--gold); font-size:1.05rem; margin:0 0 6px }
    .item{ font-size:.95rem; color:#dbe2f1; margin:3px 0 }
    .label{ color:#94a3b8 }
    .pill{ display:inline-block; padding:.15rem .5rem; border-radius:999px; border:1px solid var(--border); color:var(--gold); background:rgba(245,197,24,.12); font-size:.8rem }
  </style>
</head>
<body>
  <header>
    <%- include('partials/header') %>
  </header>

  <main class="container">
    <h1>üïí S√©ances disponibles</h1>

    <!-- Bouton retour -->
    <div class="text-center mb-3">
      <a href="/reservation?cinemaId=<%= selectedCinema %>" class="btn btn-outline-light">
        <i class="bi bi-arrow-left"></i> Retour √† la r√©servation
      </a>
    </div>

    <!-- Liste des s√©ances -->
    <% if (seances && seances.length > 0) { %>
      <div class="row g-3">
        <% seances.forEach(s => { %>
          <div class="col-12 col-md-6 col-lg-4">
            <div class="show-card h-100">
              <h5 class="show-title"><i class="bi bi-film"></i> <%= s.film_titre %></h5>

              <div class="item">
                <span class="label"><i class="bi bi-easel"></i> Salle&nbsp;:</span>
                <%= s.nom_salle %>
              </div>

              <div class="item">
                <span class="label"><i class="bi bi-badge-hd"></i> Qualit√©&nbsp;:</span>
                <span class="pill"><%= s.qualite_projection %></span>
              </div>

              <div class="item">
                <span class="label"><i class="bi bi-calendar-event"></i> Date&nbsp;:</span>
                <span class="date-format" data-date="<%= s.date_seance %>"></span>
              </div>

              <div class="item">
                <span class="label"><i class="bi bi-clock"></i> Horaire&nbsp;:</span>
                <span class="time-format" data-time="<%= s.heure_debut %>"></span> ‚Äì 
                <span class="time-format" data-time="<%= s.heure_fin %>"></span>
              </div>

              <div class="item">
                <span class="label"><i class="bi bi-cash-coin"></i> Prix&nbsp;:</span>
                <%= Number(s.prix_unitaire ?? s.prix).toFixed(2) %> ‚Ç¨
              </div>

              <div class="item text-success">
                <i class="bi bi-ticket-perforated"></i> Places restantes :
                <strong><%= s.places_restantes %></strong>
              </div>

              <a class="btn btn-cinema mt-2 w-100"
                 href="/sieges?seanceId=<%= s.id_seance %>&cinemaId=<%= selectedCinema %>&filmId=<%= selectedFilm %>&nbPlaces=<%= (nbPlaces || 1) %>">
                <i class="bi bi-chair"></i> R√©server
              </a>
            </div>
          </div>
        <% }) %>
      </div>
    <% } else { %>
      <p class="text-center text-warning mt-4">
        <i class="bi bi-info-circle"></i> Aucune s√©ance disponible pour vos crit√®res.
      </p>
    <% } %>
  </main>

  <footer>
    <%- include('partials/footer') %>
  </footer>

  <script>
    // Format heures (HH:MM -> HHhMM)
    document.querySelectorAll('.time-format').forEach(el=>{
      const t=(el.dataset.time||'').split(':'); if(t.length>=2){ el.textContent=`${t[0].padStart(2,'0')}h${t[1].padStart(2,'0')}`;}
    });
    // Format date (yyyy-mm-dd)
    document.querySelectorAll('.date-format').forEach(el=>{
      const d=new Date(el.dataset.date); if(!isNaN(d)) el.textContent=d.toLocaleDateString('fr-FR',{weekday:'long',year:'numeric',month:'long',day:'numeric'});
    });
    // fondu
    window.addEventListener('load',()=>document.body.classList.add('loaded'));
  </script>
</body>
</html>
