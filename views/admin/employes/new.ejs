<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title><%= title || 'Cr√©er un employ√©' %> - Cin√©phoria</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Google Fonts & Bootstrap & FontAwesome -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500&family=Cinzel:wght@600&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <link href="/css/styles.css" rel="stylesheet">

  <style>
    body {
      min-height: 100vh; display: flex; flex-direction: column;
      background: radial-gradient(circle at 20% 30%, #1a1f36, #0a0f1f);
      background-size: 300% 300%; animation: gradientMove 15s ease infinite;
      color: #f1f1f1; font-family: 'Poppins', sans-serif;
      opacity: 0; transition: opacity 1.2s ease;
    }
    body.loaded { opacity: 1; }
    @keyframes gradientMove {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    .cinema-card {
      background: rgba(255,255,255,0.07);
      border: 1.2px solid rgba(245,197,24,0.33);
      border-radius: 18px;
      backdrop-filter: blur(15px);
      box-shadow: 0 0 38px rgba(0,0,0,0.75);
      transition: transform 0.4s, box-shadow 0.4s;
    }
    .cinema-card:hover { transform: translateY(-4px) scale(1.013); box-shadow: 0 0 50px rgba(245,197,24,0.23); }
    .fade-in { opacity: 0; transform: translateY(25px); animation: fadeInUp 1s ease forwards; }
    @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }
    h1 {
      font-family: 'Cinzel', serif; color: #f5c518;
      text-shadow: 0 0 14px rgba(245,197,24,0.5), 0 0 18px rgba(0,0,0,0.8);
      font-size: 2.1rem; margin-bottom: 1.2em;
      text-align: center;
    }
    .cinema-label { color: #f5c518; font-weight: 500; text-shadow: 0 0 6px rgba(0,0,0,0.7); }
    .form-control, .form-select {
      background: rgba(255,255,255,0.10);
      border: 1px solid rgba(255,255,255,0.18);
      color: #fff; border-radius: 8px;
      transition: border 0.3s, box-shadow 0.3s;
    }
    .form-control:focus, .form-select:focus {
      background: rgba(0,0,0,0.3);
      border-color: #f5c518;
      box-shadow: 0 0 10px rgba(245,197,24,0.48);
      outline: none;
      color: #fff;
    }
    .input-group-text {
      background: rgba(245,197,24,0.12);
      border: 1px solid rgba(245,197,24,0.19);
      color: #f5c518;
    }
    .invalid-feedback { color: #ff4257; }
    .valid-feedback { color: #32d677; }
    .btn-cinema {
      background: linear-gradient(45deg, #ff004d, #a700ff);
      color: #fff; font-weight: bold; border-radius: 8px;
      padding: 13px; border: none; text-shadow: 0 0 6px rgba(0,0,0,0.8);
      transition: transform 0.4s, box-shadow 0.4s;
      position: relative; overflow: hidden; margin-top: 10px;
    }
    .btn-cinema:hover { transform: scale(1.05); box-shadow: 0 0 24px rgba(245,197,24,0.46); }
    .policy-note { font-size: .95rem; color: #cfd6e1; }
    @media (max-width: 540px) {
      .cinema-card { padding: 1.2rem 0.7rem 1.5rem 0.7rem; }
      h1 { font-size: 1.15rem; }
    }
  </style>
</head>
<body>
  <%- include('../../partials/header') %>

  <main class="container mt-5 mb-5 fade-in">
    <div class="row justify-content-center">
      <div class="col-md-8 col-lg-6">
        <div class="card cinema-card shadow p-5">

          <h1>üë∑‚Äç‚ôÄÔ∏è <%= title || 'Cr√©er un compte employ√©' %></h1>

          <!-- Messages d'erreurs globaux -->
          <% if (Array.isArray(error) && error.length) { %>
            <div class="alert alert-danger" role="alert">
              <ul class="mb-0">
                <% error.forEach(e => { %>
                  <li><%= e.message || e %></li>
                <% }) %>
              </ul>
            </div>
          <% } %>

          <form action="<%= actionUrl %>" method="POST" autocomplete="off" novalidate id="createEmployeeForm">
            <% if (csrfToken && csrfToken !== 'null') { %>
              <input type="hidden" name="_csrf" value="<%= csrfToken %>">
            <% } %>

            <!-- Email -->
            <div class="mb-3">
              <label for="email" class="form-label cinema-label">Adresse e-mail (employ√©)</label>
              <div class="input-group">
                <span class="input-group-text"><i class="fa fa-envelope"></i></span>
                <input
                  type="email"
                  class="form-control"
                  id="email"
                  name="email"
                  required
                  autocomplete="email"
                  value="<%= (old && old.email) ? old.email : '' %>">
              </div>
              <div class="invalid-feedback">Veuillez saisir une adresse e-mail valide.</div>
            </div>

            <!-- Mot de passe -->
            <div class="mb-3">
              <label for="password" class="form-label cinema-label">
                Mot de passe
                <small class="policy-note">‚Äî min <%= (pdwPolicy && pdwPolicy.nimLength) ? pdwPolicy.nimLength : 8 %> caract√®res</small>
              </label>
              <div class="input-group">
                <span class="input-group-text"><i class="fa fa-lock"></i></span>
                <input
                  type="password"
                  class="form-control"
                  id="password"
                  name="password"
                  required
                  minlength="<%= (pdwPolicy && pdwPolicy.nimLength) ? pdwPolicy.nimLength : 8 %>"
                  autocomplete="new-password">
                <span class="input-group-text" id="togglePwd" style="cursor:pointer;">
                  <i class="fa fa-eye" id="iconPwdEye"></i>
                </span>
              </div>
              <div class="invalid-feedback">Veuillez entrer un mot de passe valide.</div>
            </div>

            <!-- Confirmation mot de passe -->
            <div class="mb-3">
              <label for="password_confirm" class="form-label cinema-label">Confirmer le mot de passe</label>
              <div class="input-group">
                <span class="input-group-text"><i class="fa fa-lock"></i></span>
                <input
                  type="password"
                  class="form-control"
                  id="password_confirm"
                  name="password_confirm"
                  required
                  minlength="<%= (pdwPolicy && pdwPolicy.nimLength) ? pdwPolicy.nimLength : 8 %>"
                  autocomplete="new-password">
                <span class="input-group-text" id="togglePwd2" style="cursor:pointer;">
                  <i class="fa fa-eye" id="iconPwdEye2"></i>
                </span>
              </div>
              <div class="invalid-feedback">La confirmation doit correspondre au mot de passe.</div>
            </div>

            <!-- R√¥le (fix√© √† EMPLOYEE par d√©faut) -->
            <div class="mb-3">
              <label for="role_employe" class="form-label cinema-label">R√¥le</label>
              <div class="input-group">
                <span class="input-group-text"><i class="fa fa-user-tag"></i></span>
                <select class="form-select" id="role_employe" name="role_employe" required>
                  <option value="EMPLOYEE" selected>Employ√©</option>
                  <!-- Si un jour tu veux permettre la cr√©ation d'admins, d√©commente :
                  <option value="ADMIN">Administrateur</option>
                  -->
                </select>
              </div>
              <div class="invalid-feedback">Veuillez s√©lectionner un r√¥le.</div>
            </div>

            <!-- Actions -->
            <div class="d-grid gap-2">
              <button type="submit" class="btn btn-cinema btn-lg">
                <i class="fa fa-user-plus"></i> Cr√©er le compte employ√©
              </button>
              <a href="<%= backUrl %>" class="btn btn-outline-light mt-2">
                <i class="fa fa-arrow-left"></i> Retour √† la liste
              </a>
            </div>
          </form>

        </div>
      </div>
    </div>
  </main>

  <%- include('../../partials/footer') %>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    window.addEventListener("load", () => { document.body.classList.add("loaded"); });

    // Afficher/masquer mot de passe (x2)
    const pwd  = document.getElementById('password');
    const eye1 = document.getElementById('iconPwdEye');
    document.getElementById('togglePwd').onclick = function () {
      if (pwd.type === 'password') { pwd.type = 'text'; eye1.classList.replace('fa-eye','fa-eye-slash'); }
      else { pwd.type = 'password'; eye1.classList.replace('fa-eye-slash','fa-eye'); }
    };
    const pwd2  = document.getElementById('password_confirm');
    const eye2 = document.getElementById('iconPwdEye2');
    document.getElementById('togglePwd2').onclick = function () {
      if (pwd2.type === 'password') { pwd2.type = 'text'; eye2.classList.replace('fa-eye','fa-eye-slash'); }
      else { pwd2.type = 'password'; eye2.classList.replace('fa-eye-slash','fa-eye'); }
    };

    // Validation client (Bootstrap) + correspondance des mots de passe
    (function () {
      'use strict';
      const form = document.getElementById('createEmployeeForm');
      form.addEventListener('submit', function (event) {
        const minLen = Number(<%= (pdwPolicy && pdwPolicy.nimLength) ? pdwPolicy.nimLength : 8 %>);
        // R√®gle simple : m√™mes valeurs + longueur minimale
        if (pwd.value.length < minLen || pwd.value !== pwd2.value || !form.checkValidity()) {
          event.preventDefault();
          event.stopPropagation();
          if (pwd.value !== pwd2.value) {
            document.getElementById('password_confirm').setCustomValidity('Mismatch');
          } else {
            document.getElementById('password_confirm').setCustomValidity('');
          }
        } else {
          document.getElementById('password_confirm').setCustomValidity('');
        }
        form.classList.add('was-validated');
      }, false);
    })();
  </script>
</body>
</html>
