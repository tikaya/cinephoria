<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Mon espace ‚Äì Cin√©phoria</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Cinzel:wght@600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/styles.css">

  <style>
    :root {
      --gold: #f5c518;
      --gold-light: #ffd84a;
      --bg1: #0a0f1f;
      --bg2: #121829;
      --ink: #e4e4e4;
    }

    body {
      background: radial-gradient(circle at center, var(--bg2) 0%, var(--bg1) 100%);
      color: var(--ink);
      font-family: 'Poppins', sans-serif;
      overflow-x: hidden;
      opacity: 0;
      transition: opacity 1s ease;
      min-height: 100vh;
    }
    body.loaded { opacity: 1; }

    .text-cinema {
      font-family: 'Cinzel', serif;
      color: var(--gold);
      text-shadow: 0 0 12px rgba(245,197,24,0.6);
      text-align: center;
      margin-bottom: 1.8rem;
      letter-spacing: 1px;
    }

    .card-cinema {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(245,197,24,0.25);
      border-radius: 14px;
      padding: 1.5rem;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(6px);
      color: var(--ink);
      position: relative;
      overflow: hidden;
    }

    .card-cinema::before {
      content: "";
      position: absolute;
      top: 0;
      left: -50%;
      width: 200%;
      height: 100%;
      background: radial-gradient(circle at top left, rgba(245,197,24,0.12), transparent 60%);
      transform: rotate(25deg);
      pointer-events: none;
      z-index: 0;
    }

    .card-cinema * {
      position: relative;
      z-index: 1;
    }

    .card-cinema:hover {
      transform: translateY(-6px);
      box-shadow: 0 0 30px rgba(245,197,24,0.25);
    }

    .fadein-soft {
      opacity: 0;
      animation: fadein 0.9s ease forwards;
    }

    @keyframes fadein {
      from { opacity: 0; transform: translateY(8px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .text-gold { color: var(--gold); }
  </style>
</head>

<body>
  <header>
    <%- include('../partials/header', { currentUser }) %>
  </header>

  <main class="container py-5">

    <h1 class="text-cinema">üéüÔ∏è Mon Espace Utilisateur</h1>

    <p class="text-center mb-5" style="font-size:1.1rem; color:#ccc;">
      Bonjour <strong><%= currentUser?.username || currentUser?.email %></strong>, voici toutes vos commandes.
    </p>

    <h2 class="text-cinema" style="font-size:1.6rem;">üßæ Mes commandes</h2>

    <% if (reservations.length === 0) { %>
      <div class="alert alert-warning text-center shadow-sm mt-4"
           style="background:rgba(245,197,24,0.12); border-left:3px solid var(--gold); color:var(--gold);">
        Vous n‚Äôavez encore effectu√© aucune commande.
      </div>
    <% } %>

    <div class="row g-4 mt-3">

      <% reservations.forEach(r => { %>
        <div class="col-12">
          <div class="card-cinema fadein-soft">

            <h4 class="fw-bold mb-3"
                style="font-family:'Cinzel',serif; color:var(--gold); letter-spacing:0.5px;">
              <i class="fa-solid fa-film me-2"></i> <%= r.titre %>
            </h4>

            <div class="row mb-3">

              <div class="col-md-6">
                <p class="mb-1">
                  <strong class="text-gold"><i class="fa-solid fa-calendar me-1"></i>Date :</strong>
                  <%= new Date(r.date_seance).toLocaleDateString() %>
                </p>

                <p class="mb-1">
                  <strong class="text-gold"><i class="fa-solid fa-clock me-1"></i>Horaire :</strong>
                  <%= r.heure_debut %> ‚Üí <%= r.heure_fin %>
                </p>
              </div>

              <div class="col-md-6">
                <p class="mb-1">
                  <strong class="text-gold"><i class="fa-solid fa-chair me-1"></i>Places :</strong>
                  <%= r.nombre_places %>
                </p>

                <p class="mb-1">
                  <strong class="text-gold"><i class="fa-solid fa-coins me-1"></i>Total :</strong>
                  <%= r.prix_total %> ‚Ç¨
                </p>
              </div>

            </div>

            <div class="mb-2">
              <span class="badge px-3 py-2"
                style="background:rgba(245,197,24,0.15); border:1px solid var(--gold); color:var(--gold); font-size:0.95rem;">
                <i class="fa-solid fa-info-circle me-1"></i>
                <%= r.etat %>
              </span>
            </div>

            <% if (r.can_rate) { %>
              <a href="/user/note/<%= r.id_reservation %>" 
                 class="btn btn-cinema mt-3"
                 style="background-color:var(--gold); color:#000; font-weight:600; border-radius:6px;">
                 ‚≠ê Noter ce film
              </a>
            <% } %>

          </div>
        </div>
      <% }) %>

    </div>
  </main>

  <footer class="text-center mt-5 py-4"
          style="color:#999; font-size:0.85rem; border-top:1px solid rgba(245,197,24,0.15);">
    ¬© <%= new Date().getFullYear() %> Cin√©phoria
  </footer>

  <script>
    window.addEventListener("load", () => document.body.classList.add("loaded"));
  </script>

</body>
</html>
