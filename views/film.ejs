<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Films - Cin√©phoria</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/styles.css">
  <style>
    /* --- Animation d‚Äôapparition des films --- */
    .netflix-card {
      opacity: 0;
      transform: translateY(30px);
      transition: opacity 0.6s ease, transform 0.6s ease;
    }
    .netflix-card.visible {
      opacity: 1;
      transform: translateY(0);
    }

    /* --- Zoom sur image au survol --- */
    .card-img-top {
      transition: transform 0.4s ease;
    }
    .card:hover .card-img-top {
      transform: scale(1.08);
    }

    /* --- Formulaire : animation sur hover --- */
    form.netflix-card {
      background-color: #1f1f1f;
      transition: box-shadow 0.3s ease, transform 0.3s ease;
    }
    form.netflix-card:hover {
      box-shadow: 0 0 20px rgba(229,9,20,0.5);
      transform: scale(1.02);
    }
  </style>
</head>
<body class="bg-dark text-light">
  <!-- Header commun -->
  <%- include('partials/header') %>

  <main class="container mt-5">
    <!-- Titre principal -->
    <h1 class="text-center mb-5 text-netflix">üé¨ D√©couvrez nos Films</h1>

    <!-- Formulaire de filtres (cin√©ma, genre, jour) -->
    <form method="GET" action="/films" class="row g-3 align-items-end mb-5 p-4 rounded netflix-card shadow">
      <div class="col-md-4">
        <label for="cinemaId" class="form-label text-light">üéüÔ∏è Cin√©ma</label>
        <select name="cinemaId" id="cinemaId" class="form-select bg-dark text-light border-netflix">
          <option value="">Tous</option>
          <% (cinemas || []).forEach(cinema => { %>
            <option value="<%= cinema.id_cinema %>" <%= selectedCinema == cinema.id_cinema ? 'selected' : '' %>>
              <%= cinema.nom_cinema %>
            </option>
          <% }) %>
        </select>
      </div>

      <div class="col-md-4">
        <label for="genre" class="form-label text-light">üé≠ Genre</label>
        <select name="genre" id="genre" class="form-select bg-dark text-light border-netflix">
          <option value="">Tous</option>
          <% (genres || []).forEach(g => { %>
            <option value="<%= g %>" <%= selectedGenre == g ? 'selected' : '' %>><%= g %></option>
          <% }) %>
        </select>
      </div>

      <div class="col-md-4">
        <label for="date" class="form-label text-light">üìÖ Jour</label>
        <input type="date" name="date" id="date" 
               class="form-control bg-dark text-light border-netflix" 
               value="<%= selectedDate || '' %>">
      </div>

      <div class="col-12 d-grid mt-3">
        <button type="submit" class="btn btn-netflix btn-lg shadow">üîç Filtrer</button>
      </div>
    </form>

    <!-- Liste des films -->
    <% if (films && films.length > 0) { %>
      <div class="row">
        <% films.forEach(film => { %>
          <div class="col-md-4 mb-4">
            <div class="card netflix-card h-100 shadow-lg">
              <!-- Affiche -->
              <img src="<%= film.affiche_url %>" class="card-img-top" alt="Affiche de <%= film.titre %>">
              
              <!-- Corps de la carte -->
              <div class="card-body">
                <h5 class="card-title text-netflix"><%= film.titre %></h5>
                <p class="film-age">√Çge minimum : <%= film.age_minimum %>+</p>
                <p class="film-description"><%= film.description %></p>
                <p class="film-note">
                  <strong class="text-warning">Note moyenne :</strong> 
                  <%= film.note_moyenne %> / 5
                </p>

                <% if (film.label_coup_de_coeur) { %>
                  <span class="badge badge-heart">Coup de c≈ìur ‚ù§Ô∏è</span>
                <% } %>
              </div>
            </div>
          </div>
        <% }) %>
      </div>
    <% } else { %>
      <p class="text-center text-light mt-5">Aucun film trouv√© pour vos crit√®res.</p>
    <% } %>
  </main>

  <!-- Footer -->
  <%- include('partials/footer') %>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Animation d'apparition progressive des cartes
    document.addEventListener("DOMContentLoaded", () => {
      const cards = document.querySelectorAll(".netflix-card");
      const observer = new IntersectionObserver(entries => {
        entries.forEach(entry => {
          if (entry.isIntersecting) entry.target.classList.add("visible");
        });
      }, { threshold: 0.1 });

      cards.forEach(card => observer.observe(card));
    });
  </script>
  <script>
// Rendre le body visible apr√®s le chargement
window.addEventListener("load", () => {
  document.body.classList.add("loaded");
});
</script>

</body>
</html>
